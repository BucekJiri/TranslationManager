# Translation Manager

[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/nodes-ios/NStackSDK/blob/master/LICENSE)

Translation Manager is a tool for handling bundled and on-the-fly translations in your iOS application.

## How does it work?

This TranslationManager tool is a manager for downloading, storing and managing translations. It provides protocols that you can use to provide it with required 
data from your own Interactors/API's.

## üìù Requirements

* Swift 5.0+

## üì¶ Installation

### Carthage
~~~
# Swift 5
github "nodes-ios/TranslationManager"
~~~

## üíª Usage

> **NOTE:** Don't forget to `import TranslationManager` in the top of the file.

### Getting Started

To get started with the TranslationManager you will have to initalise the manager. It uses Generics for the Language & Localization Models.
~~~~swift
let manager = TranslatableManager<Language, Localization>(repository: repository,
                                                   contextRepository: repository,
                                                   localizableModel: configuration.translationsClass,
                                                   updateMode: .manual)
~~~~

The `Language` class needs to conform to the `LanguageModel` protocol. This assures the model has a locale and flags that tell the language if it should be the default 
language used or the best fit language for the user.

The `Localization` class conforms to the `LocalizationModel` protocol. You can think of this as a configuration type object that contains a `Language` object, whether
the localization needs to be updated and the url that the translations are available from. 

The manager then needs its two repositories (`TranslationRepository` & `LocalizationContextRepository`), these will be the classes that conform to the required protocols
to supply the manager with the required data. 

The `LocalizableModel` is then your Translation class that conforms to the `LocalizableModel`. This is the class currently generated by the [nstack translations generator](https://github.com/nodes-ios/nstack-translations-generator).
It can then override the class and subscript functions defined in this sdk and supply it with the required classes for the sections/keys that the translations require.

`UpdateMode` is used to determine whether the Manager should automatically fetch and overwrite the current translations on initalization. If you implement the 
`ApplicationStateObserverDelegate` and have `updateMode` set to true, it will also update translations whenever the application enters the foreground.

## How it works

- The main feature of this SDK is to handle the fetching and storing of translations and making sure to return the required translation when needed.
- When updating translations, it will first fetch a a configuration (an array of available `Localizations`). 
- Once it has those, it will cache any localizations and whether they should be the required `BestFit` or `Default` languages. These are determind by what is set as the `acceptLanguageHeader`,
  this will either use any language override that is set or preferred languages set on the device.
- For any localizations that have `requireUpdate` set to true, the manager will then fetch those from its set repository and cache them, writing them to a backup file for later use.
- Then when a translation is required, you can fetch a single translation using the section & key names or all transaltions, either specifying a locale or just using the preferred option set by the configurations. 
  These functions will then return the translations in memory or the persisted transations wrote to file when downloaded.

## Features

- You can set a delegate (`TranslatableManagerDelegate`) which is called whenever the language is updated allowing you to make UI changes or handle any way you wish within your application.

- You can also set a language override if you wish. This will use your `Language` model you defined when initalizing the Manager. This is if you did not want to use the language set as
the best fit langauge or the default language set by the repositories. This would be for example, if you gave the user a choice of language within the application which differed from the one set 
in the users phone settings. If `UpdateMode` is set to `.automatic` and the language override is set. It will then make a call to the repository again, resulting in finding the new `bestFitLangauge`
subject to the new language override. 

- A fallback locale can be set just incase your repository has issues and does not return any `default` or `bestFit` languages

- You can clear all cached/persisted translations with `TranslatableManager.clearTranslations()`


#### Release

To make releases easier, there is a makefile in the repository that automatically updates all required files (ie. `podspec`, `CHANGELOG.md` and the `Info.plist`).

To use it run the following:

```bash
$ make release '[VERSION]: [VERSION TEXT]'
# ... ie.
$ make release '0.0.7: Update mode feature'
```

## üë• Credits
Made with ‚ù§Ô∏è at [Nodes](http://nodesagency.com).

## üìÑ License
**TranslationManager** is available under the MIT license. See the [LICENSE](https://github.com/nodes-ios/TranslationManager/blob/master/LICENSE) file for more info.
